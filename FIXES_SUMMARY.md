# ‚úÖ –†–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π Railway –ë–î –∏ —è–∑—ã–∫–∞

## üéØ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–ø–µ—Ä—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ –Ω–∞ Railway**

**–§–∞–π–ª:** `app/core/config.py`

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `database_path` —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º `/app/persist` –Ω–∞ Railway
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ë–î
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏ –∫ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ Property `database_url` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SQLAlchemy URL

**–≠—Ñ—Ñ–µ–∫—Ç:** –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ –Ω–∞ Railway

### 2. **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**

**–§–∞–π–ª—ã:** 
- `app/bot/handlers/start.py` - –≤—Å–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `app/bot/middlewares/role.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
- `app/bot/middlewares/i18n.py` - –ø–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏–∑ –ë–î

**–î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏:**
- `[LANGUAGE]` - –≤—ã–±–æ—Ä –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞
- `[INVITE]` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–∞
- `[DEPT]` - –≤—ã–±–æ—Ä –æ—Ç–¥–µ–ª–∞
- `[MIDDLEWARE]` - –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
- `[I18N]` - –ø–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏–∑ –ë–î
- `[CONFIG]` - –ø—É—Ç—å –∫ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**–≠—Ñ—Ñ–µ–∫—Ç:** –í Railway –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –º–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

### 3. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ FSM state**

**–§–∞–π–ª:** `app/bot/handlers/start.py`

- ‚úÖ `await state.clear()` –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ (–∞–¥–º–∏–Ω)
- ‚úÖ `await state.clear()` –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –æ—Ç–¥–µ–ª–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ FSM

**–≠—Ñ—Ñ–µ–∫—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### 4. **Middleware —É–ª—É—á—à–µ–Ω–∏—è**

**–§–∞–π–ª—ã:**
- `app/bot/middlewares/role.py` - –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `user_exists`
- `app/bot/middlewares/i18n.py` - —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–≠—Ñ—Ñ–µ–∫—Ç:** –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤ –ª–æ–≥–∞—Ö –Ω–∞—Ö–æ–¥–∏—Ç –ª–∏ middleware –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î

## üìã –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
M app/core/config.py              - Database path –¥–ª—è Railway
M app/bot/handlers/start.py       - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ + state.clear()
M app/bot/middlewares/role.py     - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + user_exists flag
M app/bot/middlewares/i18n.py     - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ language retrieval
+ RAILWAY_DB_FIX.md               - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
+ RAILWAY_FIX_COMMANDS.txt        - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–ø–ª–æ—è
```

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∫–æ–º–º–∏—Ç—É

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ `RAILWAY_FIX_COMMANDS.txt`:

```powershell
git add app/core/config.py app/bot/handlers/start.py app/bot/middlewares/role.py app/bot/middlewares/i18n.py RAILWAY_DB_FIX.md RAILWAY_FIX_COMMANDS.txt

git commit -m "Fix: Database persistence and language saving on Railway"

git push origin main
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

–í Railway –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

**–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:**
```
[CONFIG] Database path: /app/persist/uqsoft.db
```

**–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:**
```
[LANGUAGE] ‚úÖ Admin user created with language=ru, saved to DB
[LANGUAGE] FSM cleared for user X
```

**–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º /start:**
```
[MIDDLEWARE] User X found in DB: role=admin, lang=ru
[I18N] User X language from DB: ru
Existing user: X (Name)
```

**–ï—Å–ª–∏ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –î–æ–±–∞–≤—å—Ç–µ Volume –≤ Railway: `/app/persist`
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DATABASE_PATH=/app/persist/uqsoft.db`
3. Redeploy

---

**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã!** üéâ
