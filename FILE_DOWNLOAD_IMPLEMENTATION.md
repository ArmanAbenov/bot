# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

**–§–∞–π–ª:** `app/bot/handlers/admin.py`, —Ñ—É–Ω–∫—Ü–∏—è `handle_kb_file_callback`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üì• –°–∫–∞—á–∞—Ç—å" –≤ –∫–∞—Ä—Ç–æ—á–∫—É —Ñ–∞–π–ª–∞
- –ö–Ω–æ–ø–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞ –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π —É–¥–∞–ª–µ–Ω–∏—è
- `callback_data`: `kb_download:{dept_name}:{filename}`

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```
üìÑ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ

–ò–º—è: guide.txt
–†–∞–∑–º–µ—Ä: 1.2 KB
–û—Ç–¥–µ–ª: –°–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä

[üì• –°–∫–∞—á–∞—Ç—å]
[‚ùå –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ —Ñ–∞–π–ª–∞–º]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –æ—Ç–¥–µ–ª–∞–º]
```

### 2. –•–µ–Ω–¥–ª–µ—Ä —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

**Callback:** `kb_download:{dept_name}:{filename}`

**–ü—Ä–æ—Ü–µ—Å—Å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞:**
   - –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã
   - –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ-–∞–¥–º–∏–Ω–∞: "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤"

2. **–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞:**
   - –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É: `data/knowledge/{dept_name}/{filename}`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
   - –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal –∞—Ç–∞–∫

3. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `FSInputFile` –∏–∑ aiogram
   - –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç –≤ —á–∞—Ç
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–¥–µ–ª–µ –∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí "‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
   - Path traversal ‚Üí "‚ùå –û—à–∏–±–∫–∞: –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É"
   - –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–∞: {–ø—Ä–∏—á–∏–Ω–∞}"

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

```python
if not await check_admin_access(callback.from_user.id):
    await callback.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤.", show_alert=True)
    return
```

**–ó–∞—â–∏—Ç–∞:**
- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã
- –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –ó–∞—â–∏—Ç–∞ –æ—Ç Path Traversal

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ knowledge –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
file_path_resolved = file_path.resolve()
knowledge_path_resolved = knowledge_path.resolve()
if not str(file_path_resolved).startswith(str(knowledge_path_resolved)):
    logger.error(f"Security: Path traversal attempt blocked: {file_path}")
    await callback.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É.", show_alert=True)
    return
```

**–ó–∞—â–∏—Ç–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `data/knowledge/`
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –≤–Ω–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ø—ã—Ç–æ–∫ `../../../etc/passwd`

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–º–ø–æ—Ä—Ç—ã

**–î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç:**
```python
from aiogram.types import FSInputFile
```

### FSInputFile

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
document = FSInputFile(file_path)

await callback.message.answer_document(
    document=document,
    caption=f"üìÑ –§–∞–π–ª –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n\n"
            f"üìÇ –û—Ç–¥–µ–ª: {dept_name}\n"
            f"üìù –ò–º—è —Ñ–∞–π–ª–∞: {filename}"
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ FSInputFile:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MIME-—Ç–∏–ø–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (PDF, DOCX, TXT, etc.)
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –≤ –ø–∞–º—è—Ç—å —Ü–µ–ª–∏–∫–æ–º

### –ü—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
data/knowledge/
‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îú‚îÄ‚îÄ wifi_password.txt
‚îÇ   ‚îî‚îÄ‚îÄ office_rules.pdf
‚îú‚îÄ‚îÄ sorting/
‚îÇ   ‚îú‚îÄ‚îÄ guide.txt
‚îÇ   ‚îî‚îÄ‚îÄ procedures.docx
‚îú‚îÄ‚îÄ delivery/
‚îÇ   ‚îî‚îÄ‚îÄ courier/
‚îÇ       ‚îî‚îÄ‚îÄ routes.pdf
‚îî‚îÄ‚îÄ manager/
    ‚îî‚îÄ‚îÄ reports.xlsx
```

**–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏:**
```python
knowledge_path = Path("data/knowledge")
file_path = knowledge_path / dept_name / filename
# –†–µ–∑—É–ª—å—Ç–∞—Ç: data/knowledge/sorting/guide.txt
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ callback_data

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**
```
kb_download:{dept_name}:{filename}
```

**–î–ª–∏–Ω–∞:**
- –õ–∏–º–∏—Ç: 64 –±–∞–π—Ç–∞
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞: 20-40 –±–∞–π—Ç
- –ü—Ä–∏–º–µ—Ä: `kb_download:sorting:guide.txt` = 32 –±–∞–π—Ç–∞ ‚úÖ

**–ï—Å–ª–∏ —Ñ–∞–π–ª —Å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º:**
- Aiogram –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∂–µ—Ç –∏–ª–∏ –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É
- –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–µ—à –∏–ª–∏ ID —Ñ–∞–π–ª–∞

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```python
logger.info(f"Admin {callback.from_user.id} downloading file: {dept_name}/{filename}")
logger.info(f"Admin {callback.from_user.id} successfully downloaded file: {dept_name}/{filename}")
logger.error(f"File not found on disk: {file_path}")
logger.error(f"Security: Path traversal attempt blocked: {file_path}")
```

**–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:**

**–£—Å–ø–µ—à–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ:**
```
[INFO] Admin 123456 downloading file: sorting/guide.txt
[INFO] Admin 123456 successfully downloaded file: sorting/guide.txt
```

**–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω:**
```
[ERROR] File not found on disk: data/knowledge/sorting/missing.txt
```

**–ü–æ–ø—ã—Ç–∫–∞ path traversal:**
```
[ERROR] Security: Path traversal attempt blocked: data/knowledge/../../etc/passwd
```

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –£—Å–ø–µ—à–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ

1. –ê–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π"
2. –í—ã–±–∏—Ä–∞–µ—Ç –æ—Ç–¥–µ–ª "–°–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä"
3. –ù–∞–∂–∏–º–∞–µ—Ç –Ω–∞ —Ñ–∞–π–ª "guide.txt"
4. –í–∏–¥–∏—Ç –∫–∞—Ä—Ç–æ—á–∫—É —Ñ–∞–π–ª–∞ —Å –∫–Ω–æ–ø–∫–æ–π "üì• –°–∫–∞—á–∞—Ç—å"
5. –ù–∞–∂–∏–º–∞–µ—Ç "üì• –°–∫–∞—á–∞—Ç—å"
6. –ü–æ–ª—É—á–∞–µ—Ç —Ñ–∞–π–ª –≤ —á–∞—Ç —Å –ø–æ–¥–ø–∏—Å—å—é:
   ```
   üìÑ –§–∞–π–ª –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
   
   üìÇ –û—Ç–¥–µ–ª: sorting
   üìù –ò–º—è —Ñ–∞–π–ª–∞: guide.txt
   ```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω

1. –ê–¥–º–∏–Ω –ø—ã—Ç–∞–µ—Ç—Å—è —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
2. –§–∞–π–ª –±—ã–ª —É–¥–∞–ª–µ–Ω –≤—Ä—É—á–Ω—É—é —Å –¥–∏—Å–∫–∞
3. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
4. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–ø—ã—Ç–∫–∞ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

1. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø—ã—Ç–∞–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å callback_data
2. –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º –≤–Ω–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
3. –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "‚ùå –û—à–∏–±–∫–∞: –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É"
5. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø–æ–ø—ã—Ç–∫–∞ –∞—Ç–∞–∫–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

- ‚úÖ –ö–Ω–æ–ø–∫–∞ "üì• –°–∫–∞—á–∞—Ç—å" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–∞–π–ª–∞
- ‚úÖ –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
- ‚úÖ –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª –≤ —á–∞—Ç
- ‚úÖ –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–¥–µ–ª–µ
- ‚úÖ –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ —Ñ–∞–π–ª–æ–≤ (PDF, DOCX, TXT)

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–¢–µ—Å—Ç 1: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞**
```
–î–µ–π—Å—Ç–≤–∏–µ: –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª guide.txt –∏–∑ –æ—Ç–¥–µ–ª–∞ sorting
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç —Å –ø–æ–¥–ø–∏—Å—å—é
```

**–¢–µ—Å—Ç 2: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF —Ñ–∞–π–ª–∞**
```
–î–µ–π—Å—Ç–≤–∏–µ: –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª procedures.pdf –∏–∑ –æ—Ç–¥–µ–ª–∞ sorting
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: PDF –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

**–¢–µ—Å—Ç 3: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ DOCX —Ñ–∞–π–ª–∞**
```
–î–µ–π—Å—Ç–≤–∏–µ: –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª report.docx –∏–∑ –æ—Ç–¥–µ–ª–∞ manager
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: DOCX –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

**–¢–µ—Å—Ç 4: –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**
```
–î–µ–π—Å—Ç–≤–∏–µ: –ü–æ–ø—ã—Ç–∫–∞ —Å–∫–∞—á–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –û—à–∏–±–∫–∞ "—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
```

**–¢–µ—Å—Ç 5: –ü–æ–ø—ã—Ç–∫–∞ path traversal**
```
–î–µ–π—Å—Ç–≤–∏–µ: –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å callback_data: kb_download:../../../etc:passwd
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å –æ—à–∏–±–∫–æ–π "–Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø—É—Ç—å"
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π:**
   - –°—á–µ—Ç—á–∏–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
   - –ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

2. **–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞:**
   - –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ - –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏
   - –î–ª—è PDF - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü

3. **–ú–∞—Å—Å–æ–≤–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ:**
   - –°–∫–∞—á–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –æ—Ç–¥–µ–ª–∞ –∫–∞–∫ ZIP –∞—Ä—Ö–∏–≤
   - –°–∫–∞—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

4. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–∞
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞—á–∞—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é

5. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   - –†–∞–∑—Ä–µ—à–∏—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–≤–æ–µ–≥–æ –æ—Ç–¥–µ–ª–∞
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ–∞–π–ª–∞

## FAQ

**Q: –ú–æ–≥—É—Ç –ª–∏ –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã?**  
A: –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.

**Q: –ö–∞–∫–∏–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –º–æ–∂–Ω–æ —Å–∫–∞—á–∏–≤–∞—Ç—å?**  
A: –í—Å–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π: PDF, DOCX, TXT, MD, RST.

**Q: –ß—Ç–æ –µ—Å–ª–∏ —Ñ–∞–π–ª –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π?**  
A: FSInputFile —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏, –Ω–µ –∑–∞–≥—Ä—É–∂–∞—è –∏—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –ø–∞–º—è—Ç—å. Telegram –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ ~2GB.

**Q: –ú–æ–∂–Ω–æ –ª–∏ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –ø–æ–≤—Ç–æ—Ä–Ω–æ?**  
A: –î–∞, —Ñ–∞–π–ª –º–æ–∂–Ω–æ —Å–∫–∞—á–∏–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑.

**Q: –ß—Ç–æ –µ—Å–ª–∏ —Ñ–∞–π–ª –±—ã–ª —É–¥–∞–ª–µ–Ω —Å –¥–∏—Å–∫–∞ –≤—Ä—É—á–Ω—É—é?**  
A: –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç –æ—à–∏–±–∫—É "—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ" –∏ –∑–∞–ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—É.

**Q: –ó–∞—â–∏—â–µ–Ω–∞ –ª–∏ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç path traversal –∞—Ç–∞–∫?**  
A: –î–∞, –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `data/knowledge/`.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **app/bot/handlers/admin.py**
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `FSInputFile`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_kb_file_callback()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_kb_download_callback()` - —Ö–µ–Ω–¥–ª–µ—Ä —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

### –ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

–ù–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `FSInputFile` –∏–∑ aiogram.

## Rollback

–í —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞:

1. –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–º–º–∏—Ç –≤ git
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
3. –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–µ—Ç—Å—è, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏—Å—á–µ–∑–Ω–µ—Ç

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
