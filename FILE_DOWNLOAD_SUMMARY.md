# ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π - –ó–ê–í–ï–†–®–ï–ù–û

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### üì• –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

**–ì–¥–µ:** –ö–∞—Ä—Ç–æ—á–∫–∞ —Ñ–∞–π–ª–∞ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```
üìÑ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ

–ò–º—è: guide.txt
–†–∞–∑–º–µ—Ä: 1.2 KB
–û—Ç–¥–µ–ª: –°–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä

[üì• –°–∫–∞—á–∞—Ç—å]     ‚Üê –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê
[‚ùå –£–¥–∞–ª–∏—Ç—å]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ —Ñ–∞–π–ª–∞–º]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –æ—Ç–¥–µ–ª–∞–º]
```

### üîß –•–µ–Ω–¥–ª–µ—Ä —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

**–§—É–Ω–∫—Ü–∏—è:** `handle_kb_download_callback()`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
2. ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç —Ñ–∞–π–ª –ø–æ –ø—É—Ç–∏ `data/knowledge/{dept}/{filename}`
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `FSInputFile` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
4. ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª –≤ —á–∞—Ç —Å –ø–æ–¥–ø–∏—Å—å—é
5. ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, etc.)
6. ‚úÖ –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç path traversal –∞—Ç–∞–∫

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è –∞–¥–º–∏–Ω–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ **üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π**
2. –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ñ–∞–π–ª
4. –ù–∞–∂–º–∏—Ç–µ **üì• –°–∫–∞—á–∞—Ç—å**
5. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∞–π–ª –≤ —á–∞—Ç!

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

```
üìÑ –§–∞–π–ª –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

üìÇ –û—Ç–¥–µ–ª: sorting
üìù –ò–º—è —Ñ–∞–π–ª–∞: guide.txt

[–§–∞–π–ª: guide.txt]
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –ó–∞—â–∏—Ç–∞ –¥–æ—Å—Ç—É–ø–∞:
- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ callback

### ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫:
- Path traversal –∑–∞—â–∏—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ñ–∞–π–ª –≤ `data/knowledge/`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞

### ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –û—à–∏–±–∫–∞ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
- –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø—É—Ç—å ‚Üí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

**1. app/bot/handlers/admin.py**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `FSInputFile`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ `handle_kb_file_callback()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ `handle_kb_download_callback()` - —Ö–µ–Ω–¥–ª–µ—Ä —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

### –ù–æ–≤—ã–π callback:

```python
callback_data = f"kb_download:{dept_name}:{filename}"
# –ü—Ä–∏–º–µ—Ä: "kb_download:sorting:guide.txt"
```

### FSInputFile:

```python
document = FSInputFile(file_path)
await callback.message.answer_document(
    document=document,
    caption=f"üìÑ –§–∞–π–ª –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n\n..."
)
```

## –õ–æ–≥–∏

**–£—Å–ø–µ—à–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ:**
```
[INFO] Admin 123456 downloading file: sorting/guide.txt
[INFO] Admin 123456 successfully downloaded file: sorting/guide.txt
```

**–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω:**
```
[ERROR] File not found on disk: data/knowledge/sorting/missing.txt
```

**–ü–æ–ø—ã—Ç–∫–∞ –∞—Ç–∞–∫–∏:**
```
[ERROR] Security: Path traversal attempt blocked: data/knowledge/../../etc/passwd
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã

‚úÖ –í—Å–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤:
- `.txt`, `.md`, `.rst`
- `.pdf`, `.docx`, `.doc`
- `.xlsx`, `.xls`
- –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã

‚úÖ –†–∞–∑–º–µ—Ä:
- –î–æ ~2GB (–ª–∏–º–∏—Ç Telegram)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç:

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –û—Ç–∫—Ä—ã—Ç—å "üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π"
- [ ] –í—ã–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª "–°–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä"
- [ ] –ù–∞–∂–∞—Ç—å –Ω–∞ —Ñ–∞–π–ª
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ "üì• –°–∫–∞—á–∞—Ç—å"
- [ ] –ù–∞–∂–∞—Ç—å "üì• –°–∫–∞—á–∞—Ç—å"
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –ø—Ä–∏—à–µ–ª –≤ —á–∞—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –∫ —Ñ–∞–π–ª—É
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–∫–∞—á–∞—Ç—å PDF —Ñ–∞–π–ª
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–∫–∞—á–∞—Ç—å DOCX —Ñ–∞–π–ª
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

### –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python -m app.main

# 2. –í Telegram:
#    - –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
#    - –ü–µ—Ä–µ–π—Ç–∏ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π
#    - –í—ã–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª —Å —Ñ–∞–π–ª–∞–º–∏
#    - –ù–∞–∂–∞—Ç—å –Ω–∞ —Ñ–∞–π–ª
#    - –ù–∞–∂–∞—Ç—å "–°–∫–∞—á–∞—Ç—å"
#    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –ø–æ–ª—É—á–µ–Ω

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f logs/bot.log | grep "downloading file"
```

## –û—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚ùå "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"

**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª —É–¥–∞–ª–µ–Ω –≤—Ä—É—á–Ω—É—é

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `data/knowledge/{dept}/`
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –∑–∞–Ω–æ–≤–æ
3. –ò–ª–∏ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ –∞–¥–º–∏–Ω–∫–∏

### ‚ùå "–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—ã –∞–¥–º–∏–Ω
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `admins`

### ‚ùå "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–∞"

**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä (–ª–∏–º–∏—Ç ~2GB)
2. –°–∂–∞—Ç—å —Ñ–∞–π–ª –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

üìÑ **FILE_DOWNLOAD_IMPLEMENTATION.md** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è  
üìÑ **FILE_DOWNLOAD_GUIDE.md** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
üìÑ **FILE_DOWNLOAD_SUMMARY.md** - —ç—Ç–æ —Ä–µ–∑—é–º–µ

## –î–µ–ø–ª–æ–π

```bash
# 1. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add .
git commit -m "feat: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ üì• –°–∫–∞—á–∞—Ç—å –≤ –∫–∞—Ä—Ç–æ—á–∫—É —Ñ–∞–π–ª–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ö–µ–Ω–¥–ª–µ—Ä —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å FSInputFile
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç path traversal
- –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"

# 2. –ü—É—à –Ω–∞ —Å–µ—Ä–≤–µ—Ä
git push origin main

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ production
ssh user@server
tail -f logs/bot.log | grep "downloading"
```

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í –ø–ª–∞–Ω–∞—Ö –¥–æ–±–∞–≤–∏—Ç—å:

- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ —Å–∫–∞—á–∏–≤–∞–ª
- üîç **–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä** - –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- üì¶ **ZIP –∞—Ä—Ö–∏–≤—ã** - —Å–∫–∞—á–∞—Ç—å –≤–µ—Å—å –æ—Ç–¥–µ–ª
- üìù **–í–µ—Ä—Å–∏–∏** - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- üë• **–î–æ—Å—Ç—É–ø –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - —Å–≤–æ–µ–≥–æ –æ—Ç–¥–µ–ª–∞

## FAQ

**Q: –ú–æ–≥—É—Ç –ª–∏ –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∫–∞—á–∏–≤–∞—Ç—å?**  
A: –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã.

**Q: –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?**  
A: –í—Å–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (PDF, DOCX, TXT, etc.)

**Q: –ï—Å—Ç—å –ª–∏ –ª–∏–º–∏—Ç –Ω–∞ —Ä–∞–∑–º–µ—Ä?**  
A: ~2GB (–ª–∏–º–∏—Ç Telegram)

**Q: –ú–æ–∂–Ω–æ –ª–∏ —Å–∫–∞—á–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤?**  
A: –ü–æ–∫–∞ –ø–æ –æ–¥–Ω–æ–º—É, –º–∞—Å—Å–æ–≤–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è.

**Q: –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –ª–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è?**  
A: –î–∞, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞.

## –ì–æ—Ç–æ–≤–æ! üéâ

–¢–µ–ø–µ—Ä—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ª–µ–≥–∫–æ —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞!

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:** –õ–æ–∫–∞–ª—å–Ω–æ  
**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é:** –î–ê
