# üìã –†–µ–∑—é–º–µ —Å–µ—Å—Å–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - 13 —Ñ–µ–≤—Ä–∞–ª—è 2026

## –û–±–∑–æ—Ä

–í —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –∑–∞–¥–∞—á –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1Ô∏è‚É£ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG –∏–Ω–¥–µ–∫—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –∞–¥–º–∏–Ω–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `reload_indices()` –≤ `GeminiService`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/reload` –¥–ª—è —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –¢–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

**–§–∞–π–ª—ã:**
- `app/services/ai_service.py`
- `app/bot/handlers/admin.py`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `RAG_AUTO_RELOAD_IMPLEMENTATION.md`
- `RELOAD_GUIDE.md`

---

### 2Ô∏è‚É£ –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `remove_admin()` –≤ —Å–µ—Ä–≤–∏—Å
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É–¥–∞–ª–µ–Ω–∏—è ‚ùå
- ‚úÖ –ó–∞—â–∏—Ç–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ (ID: 375693711) - –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
- ‚úÖ Callback –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–¥–º–∏–Ω–µ

**–§–∞–π–ª—ã:**
- `app/services/admin_service.py`
- `app/bot/handlers/admin.py`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `ADMIN_REMOVAL_IMPLEMENTATION.md`
- `ADMIN_REMOVAL_GUIDE.md`
- `ADMIN_REMOVAL_SUMMARY.md`

---

### 3Ô∏è‚É£ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –æ—Ç–¥–µ–ª–æ–≤ —Å –ø–∞–ø–∫–∞–º–∏ RAG

**–ü—Ä–æ–±–ª–µ–º–∞:** RAG –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª –∏–Ω–¥–µ–∫—Å—ã –∏–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è: `"Department.SORTING"` vs `"sorting"`

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `get_display_names()` –∏ `get_admin_assignable_departments()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ `get_user_department()` –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ RAG (–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, –ø–∞–ø–∫–∞ –ø–æ–∏—Å–∫–∞)
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –∫–ª—é—á–µ–π –∏–Ω–¥–µ–∫—Å–æ–≤

**–§–∞–π–ª—ã:**
- `app/core/models.py`
- `app/utils/department.py`
- `app/services/ai_service.py`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `DEPARTMENT_SYNC_FIX.md`
- `DEPARTMENT_SYNC_SUMMARY.md`

---

### 4Ô∏è‚É£ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üì• –°–∫–∞—á–∞—Ç—å" –≤ –∫–∞—Ä—Ç–æ—á–∫—É —Ñ–∞–π–ª–∞
- ‚úÖ –•–µ–Ω–¥–ª–µ—Ä `handle_kb_download_callback()` —Å `FSInputFile`
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal –∞—Ç–∞–∫
- ‚úÖ –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (PDF, DOCX, TXT, etc.)
- ‚úÖ –ü–æ–¥–ø–∏—Å—å –∫ —Ñ–∞–π–ª—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–¥–µ–ª–µ

**–§–∞–π–ª—ã:**
- `app/bot/handlers/admin.py`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `FILE_DOWNLOAD_IMPLEMENTATION.md`
- `FILE_DOWNLOAD_GUIDE.md`
- `FILE_DOWNLOAD_SUMMARY.md`

---

### 5Ô∏è‚É£ –°–∏—Å—Ç–µ–º–∞ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤ (Security Gate)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –ø—É—Å–∫–∞–ª –≤—Å–µ—Ö –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏, –ª—é–±–æ–π –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `is_verified` –≤ –º–æ–¥–µ–ª—å `User`
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `waiting_for_invite_code`
- ‚úÖ –•–µ–Ω–¥–ª–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–∞
- ‚úÖ Middleware –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ê–¥–º–∏–Ω—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–µ–∑ –≤–≤–æ–¥–∞ –∫–æ–¥–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏

**–§–∞–π–ª—ã:**
- `app/core/models.py` - –ø–æ–ª–µ `is_verified`
- `app/utils/states.py` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM
- `app/bot/handlers/start.py` - –ª–æ–≥–∏–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `app/bot/middlewares/role.py` - –∑–∞—â–∏—Ç–∞ middleware
- `app/core/database.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- `app/core/migrations.py` - —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π (–ù–û–í–´–ô)
- `migrations/add_is_verified_field.sql` - SQL —Å–∫—Ä–∏–ø—Ç (–ù–û–í–´–ô)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `INVITE_CODE_SECURITY_IMPLEMENTATION.md`
- `INVITE_CODE_SECURITY_SUMMARY.md`

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã: 8

1. `app/bot/handlers/admin.py` - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å, —É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
2. `app/bot/handlers/start.py` - —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤
3. `app/bot/middlewares/role.py` - –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
4. `app/services/admin_service.py` - —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞
5. `app/services/ai_service.py` - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG –∏–Ω–¥–µ–∫—Å–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
6. `app/core/models.py` - –ø–æ–ª–µ `is_verified`, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π –æ—Ç–¥–µ–ª–æ–≤
7. `app/core/database.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
8. `app/utils/states.py` - –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `waiting_for_invite_code`
9. `app/utils/department.py` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –æ—Ç–¥–µ–ª–æ–≤

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã: 2

1. `app/core/migrations.py` - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π
2. `migrations/add_is_verified_field.sql` - SQL —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: 13 —Ñ–∞–π–ª–æ–≤

1. `RAG_AUTO_RELOAD_IMPLEMENTATION.md`
2. `RELOAD_GUIDE.md`
3. `ADMIN_REMOVAL_IMPLEMENTATION.md`
4. `ADMIN_REMOVAL_GUIDE.md`
5. `ADMIN_REMOVAL_SUMMARY.md`
6. `DEPARTMENT_SYNC_FIX.md`
7. `DEPARTMENT_SYNC_SUMMARY.md`
8. `FILE_DOWNLOAD_IMPLEMENTATION.md`
9. `FILE_DOWNLOAD_GUIDE.md`
10. `FILE_DOWNLOAD_SUMMARY.md`
11. `INVITE_CODE_SECURITY_IMPLEMENTATION.md`
12. `INVITE_CODE_SECURITY_SUMMARY.md`
13. `SESSION_SUMMARY_2026_02_13.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üî¥ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–î–æ:**
- ‚ùå –õ—é–±–æ–π –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ
- ‚ùå –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π

**–ü–æ—Å–ª–µ:**
- ‚úÖ –ò–Ω–≤–∞–π—Ç-–∫–æ–¥ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ Middleware –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- ‚úÖ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞
- ‚úÖ –ê–¥–º–∏–Ω—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### üî¥ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ

**–î–æ:**
- ‚ùå –ò–Ω–¥–µ–∫—Å—ã RAG –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚ùå "Department not found in indices" –æ—à–∏–±–∫–∏
- ‚ùå –¢—Ä–µ–±–æ–≤–∞–ª—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ü–æ—Å–ª–µ:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/reload` –¥–ª—è —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –¢–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –æ—Ç–¥–µ–ª–æ–≤

### üî¥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º

**–î–æ:**
- ‚ùå –ù–µ–ª—å–∑—è –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚ùå –ù–µ–ª—å–∑—è —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- ‚ùå –ê–¥–º–∏–Ω—ã –º–æ–≥–ª–∏ —É–¥–∞–ª–∏—Ç—å —Å–∞–º–∏ —Å–µ–±—è

**–ü–æ—Å–ª–µ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ –∏ –æ—Ç —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python -m app.main

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
tail -f logs/bot.log | grep "\[MIGRATION\]"

# 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞–π—Ç-–∫–æ–¥:
#    - –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start ‚Üí –∑–∞–ø—Ä–æ—Å –∫–æ–¥–∞
#    - –í–≤–µ—Å—Ç–∏ "wrong" ‚Üí –æ—à–∏–±–∫–∞
#    - –í–≤–µ—Å—Ç–∏ "UQ2026" ‚Üí —É—Å–ø–µ—Ö

# 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω–∫—É:
#    - –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
#    - –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ ‚Üí –æ—à–∏–±–∫–∞
#    - –ü–æ–ø—ã—Ç–∫–∞ —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è ‚Üí –æ—à–∏–±–∫–∞

# 5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RAG:
#    - –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª –≤ sorting
#    - –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å ‚Üí —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏—Å—å
#    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ [RAG] Available indices

# 6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ:
#    - –û—Ç–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–ó
#    - –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
#    - –ù–∞–∂–∞—Ç—å üì• –°–∫–∞—á–∞—Ç—å
#    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –ø—Ä–∏—à–µ–ª
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ production:

```bash
# 1. –î–µ–ø–ª–æ–π
git add .
git commit -m "feat: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG –∏–Ω–¥–µ–∫—Å–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–¥–µ–ª–æ–≤ —Å RAG"

git push origin main

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
ssh user@server
tail -f logs/bot.log | grep "\[MIGRATION\]"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
#    - –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –∏–Ω–≤–∞–π—Ç-–∫–æ–¥
#    - –ê–¥–º–∏–Ω ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
#    - RAG –∏–Ω–¥–µ–∫—Å—ã ‚Üí –Ω–∞—Ö–æ–¥—è—Ç –æ—Ç–¥–µ–ª—ã
#    - –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç
#    - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏—á–∏

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ò–Ω–≤–∞–π—Ç-–∫–æ–¥:**
   - –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ö–æ–¥: `UQ2026` (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `.env`)
   - –ê–¥–º–∏–Ω—ã –æ–±—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É

2. **Middleware –∑–∞—â–∏—Ç–∞:**
   - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

3. **–ó–∞—â–∏—Ç–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:**
   - –ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω (375693711) –∑–∞—â–∏—â–µ–Ω –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è
   - –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è
   - Path traversal –∑–∞—â–∏—Ç–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–¢–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ RAG:**
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π –æ—Ç–¥–µ–ª
   - –ù–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ –∏–Ω–¥–µ–∫—Å—ã
   - –ë—ã—Å—Ç—Ä–µ–µ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ
   - –ù–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –±–æ—Ç–∞

### üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

1. **–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤:**
   - `/reload` - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG –∏–Ω–¥–µ–∫—Å–æ–≤
   - "üë• –ê–¥–º–∏–Ω—ã" - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
   - "üì• –°–∫–∞—á–∞—Ç—å" - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:**
   - –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
   - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

---

## –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:

```
[MIGRATION] Running database migrations...
[MIGRATION] Adding 'is_verified' column to users table...
[MIGRATION] ‚úÖ Migration completed: is_verified column added
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–æ–ª—è `is_verified`
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
3. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: `is_verified=True`
- –î–æ—Å—Ç—É–ø –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–æ–≤—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã –≤ –ª–æ–≥–∞—Ö:

- `[RAG]` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å RAG –∏–Ω–¥–µ–∫—Å–∞–º–∏
- `[INVITE]` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤
- `[SECURITY]` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- `[MIGRATION]` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- `[DEPT]` - —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç–¥–µ–ª–∞–º–∏
- `[ADMIN]` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏

### –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:

**–£—Å–ø–µ—à–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**
```
[MIGRATION] ‚úÖ Migration completed: is_verified column added
[INVITE] ‚úÖ Correct invite code for user 123456
[RAG] ‚úÖ Indices reloaded successfully
[ADMIN] Removed admin user_id=789, username=oldadmin
[DEPT] User 123456 belongs to department: sorting (raw: Department.SORTING)
```

**–û—à–∏–±–∫–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
```
[INVITE] ‚ùå Wrong invite code for user 123456
[SECURITY] User 123456 not verified, blocking access
[RAG] Department Department.SORTING not found in indices
```

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–∞:
```
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí üîë –ò–Ω–≤–∞–π—Ç-–∫–æ–¥
–í–∏–¥–∏—Ç: UQ2026
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞:
```
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí üë• –ê–¥–º–∏–Ω—ã ‚Üí –í—ã–±—Ä–∞—Ç—å –∞–¥–º–∏–Ω–∞ ‚Üí ‚ùå –£–¥–∞–ª–∏—Ç—å
```

#### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG:
```
/reload
```

#### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞:
```
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–ó ‚Üí –û—Ç–¥–µ–ª ‚Üí –§–∞–π–ª ‚Üí üì• –°–∫–∞—á–∞—Ç—å
```

### –î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```
1. /start
2. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω–≤–∞–π—Ç-–∫–æ–¥ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –í–≤–µ—Å—Ç–∏ –∫–æ–¥: UQ2026
4. –í—ã–±—Ä–∞—Ç—å —è–∑—ã–∫
5. –í—ã–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
6. –ì–æ—Ç–æ–≤–æ!
```

---

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:

‚úÖ **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è
- –î–æ—Å—Ç—É–ø –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è
- –†–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

‚úÖ **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:**
- –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ —Å `"Department.SORTING"` –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è
- –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –î–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è

‚úÖ **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–¥–º–∏–Ω—ã:**
- –û—Å—Ç–∞—é—Ç—Å—è –∞–¥–º–∏–Ω–∞–º–∏
- –ü—Ä–∞–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è

---

## –î–µ–ø–ª–æ–π –Ω–∞ production

### –®–∞–≥ 1: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python -m app.main

# 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ 5 —Ñ–∏—á:
#    - –ò–Ω–≤–∞–π—Ç-–∫–æ–¥ (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
#    - –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
#    - RAG –∏–Ω–¥–µ–∫—Å—ã (–¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª ‚Üí –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å)
#    - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
#    - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–¥–µ–ª–æ–≤ (–ª–æ–≥–∏)

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f logs/bot.log | grep -E "\[MIGRATION\]|\[INVITE\]|\[RAG\]"
```

### –®–∞–≥ 2: –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
git add .
git commit -m "feat: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

‚úÖ –°–∏—Å—Ç–µ–º–∞ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤ (security gate)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ is_verified
- Middleware –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- –ê–¥–º–∏–Ω—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG –∏–Ω–¥–µ–∫—Å–æ–≤
- –ú–µ—Ç–æ–¥ reload_indices()
- –ö–æ–º–∞–Ω–¥–∞ /reload
- –¢–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
- –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –ó–∞—â–∏—Ç–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è

‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –ö–Ω–æ–ø–∫–∞ üì• –°–∫–∞—á–∞—Ç—å
- FSInputFile –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- Path traversal –∑–∞—â–∏—Ç–∞

‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–¥–µ–ª–æ–≤ —Å RAG
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ"

git push origin main
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ production

```bash
# 1. SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh user@server

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
tail -f logs/bot.log | grep "\[MIGRATION\]"

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# [MIGRATION] ‚úÖ Migration completed: is_verified column added

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞
#    - –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –∏–Ω–≤–∞–π—Ç-–∫–æ–¥ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è
#    - RAG –∏–Ω–¥–µ–∫—Å—ã ‚Üí –Ω–∞—Ö–æ–¥—è—Ç –æ—Ç–¥–µ–ª—ã
#    - –ê–¥–º–∏–Ω–∫–∞ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
sqlite3 /app/persist/uqsoft.db
SELECT COUNT(*) as total, SUM(is_verified) as verified FROM users;
```

---

## –í–∞–∂–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

### –ò–Ω–≤–∞–π—Ç-–∫–æ–¥:
```
UQ2026
```
–ò–∑–º–µ–Ω–∏—Ç—å –≤ `.env`: `INVITE_CODE=YourNewCode`

### –ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω (–∑–∞—â–∏—â–µ–Ω –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è):
```
375693711
```
–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –≤ –∫–æ–¥–µ: `MAIN_ADMIN_ID = 375693711`

### –†–∞–∑–º–µ—Ä callback_data:
```
64 –±–∞–π—Ç–∞ (–ª–∏–º–∏—Ç Telegram)
```
–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –ª–∏–º–∏—Ç.

---

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ (Checklist)

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

- [x] –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [x] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- [x] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ
- [ ] –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç—Ä–µ–±—É—é—Ç –∏–Ω–≤–∞–π—Ç-–∫–æ–¥
- [ ] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] RAG –∏–Ω–¥–µ–∫—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤
- [ ] –§–∞–π–ª—ã –º–æ–∂–Ω–æ —Å–∫–∞—á–∏–≤–∞—Ç—å
- [ ] –û—Ç–¥–µ–ª—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –õ–æ–≥–∏:

```bash
# –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
tail -f logs/bot.log | grep -E "\[MIGRATION\]|\[INVITE\]|\[SECURITY\]|\[RAG\]|\[ADMIN\]"

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
tail -f logs/bot.log | grep "ERROR"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
tail -f logs/bot.log | grep "User 123456"
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
sqlite3 data/uqsoft.db

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT telegram_id, full_name, is_verified, department FROM users;

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–æ–≤
SELECT user_id, username FROM admins;

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT 
    COUNT(*) as total_users,
    SUM(is_verified) as verified_users,
    COUNT(*) - SUM(is_verified) as unverified_users
FROM users;
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:

1. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG –∏–Ω–¥–µ–∫—Å–æ–≤
2. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
3. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–¥–µ–ª–æ–≤ —Å RAG
4. ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
5. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤ (Security Gate)

**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í–û –ö PRODUCTION üöÄ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô üî¥

**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ü–û–õ–ù–ê–Ø ‚úÖ

---

## –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –¥–µ–ø–ª–æ—è

```bash
git add .
git commit -m "feat: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (5 –∑–∞–¥–∞—á)"
git push origin main
```

**–ü–æ—Å–ª–µ –ø—É—à–∞:**
- –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç
