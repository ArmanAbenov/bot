# üè¢ UQsoft Multitenancy System - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## ‚úÖ –°–ò–°–¢–ï–ú–ê –ó–ê–ü–£–©–ï–ù–ê –ò –†–ê–ë–û–¢–ê–ï–¢!

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤:
```
‚úÖ delivery/courier: 26 chunks (25 common + 1 courier)
‚úÖ delivery/franchise: 25 chunks (—Ç–æ–ª—å–∫–æ common)
‚úÖ sorting: 26 chunks (25 common + 1 sorting)
‚úÖ customer_service: 25 chunks (—Ç–æ–ª—å–∫–æ common)
‚úÖ Fallback (admin): 25 chunks (common files)
```

---

## üîê –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –ò–ó–û–õ–Ø–¶–ò–Ø –ó–ù–ê–ù–ò–ô:

### –ü—Ä–∏–º–µ—Ä 1: –ö—É—Ä—å–µ—Ä
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –ö—É—Ä—å–µ—Ä (department = "delivery/courier")
**–í–∏–¥–∏—Ç:** 
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ `knowledge/common/` (25 —Ñ–∞–π–ª–æ–≤)
- ‚úÖ –§–∞–π–ª—ã –∏–∑ `knowledge/delivery/courier/` (courier_guide.txt)
- ‚ùå **–ù–ï –í–ò–î–ò–¢** —Ñ–∞–π–ª—ã –∏–∑ sorting/ (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 5678)

**–¢–µ—Å—Ç:** –ö—É—Ä—å–µ—Ä —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç "–ö–∞–∫–æ–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏?" ‚Üí –ë–æ—Ç –ù–ï –Ω–∞–π–¥–µ—Ç –æ—Ç–≤–µ—Ç (–∏–∑–æ–ª—è—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!)

### –ü—Ä–∏–º–µ—Ä 2: –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (department = "sorting")
**–í–∏–¥–∏—Ç:**
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ `knowledge/common/` (25 —Ñ–∞–π–ª–æ–≤)
- ‚úÖ –§–∞–π–ª—ã –∏–∑ `knowledge/sorting/` (sorting_rules.txt)
- ‚ùå **–ù–ï –í–ò–î–ò–¢** —Ñ–∞–π–ª—ã –∏–∑ delivery/courier/ (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ —Å–∫–ª–∞–¥–∞ 1234)

**–¢–µ—Å—Ç:** –°–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç "–ö–∞–∫–æ–π –∫–æ–¥ –æ—Ç —Å–∫–ª–∞–¥–∞ –¥–ª—è –∫—É—Ä—å–µ—Ä–æ–≤?" ‚Üí –ë–æ—Ç –ù–ï –Ω–∞–π–¥–µ—Ç –æ—Ç–≤–µ—Ç (–∏–∑–æ–ª—è—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!)

### –ü—Ä–∏–º–µ—Ä 3: –ê–¥–º–∏–Ω
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –ê–¥–º–∏–Ω (department = NULL)
**–í–∏–¥–∏—Ç:**
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ `knowledge/common/` (fallback –∏–Ω–¥–µ–∫—Å)
- ‚ö†Ô∏è –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º –æ—Ç–¥–µ–ª–∞–º –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üöÄ –ü–†–û–¶–ï–°–° –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò:

### –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∏–Ω–≤–∞–π—Ç-–∫–æ–¥
```
User: [–≤–≤–æ–¥–∏—Ç –∏–Ω–≤–∞–π—Ç-–∫–æ–¥]
Bot: ‚úÖ –û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏ —Å–≤–æ–π –æ—Ç–¥–µ–ª:
     [üì¶ –î–æ—Å—Ç–∞–≤–∫–∞]
     [üìä –°–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä]
     [üí¨ –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å]
```

### –®–∞–≥ 2: –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–î–æ—Å—Ç–∞–≤–∫–∞"
```
User: [–Ω–∞–∂–∏–º–∞–µ—Ç "üì¶ –î–æ—Å—Ç–∞–≤–∫–∞"]
Bot: –í—ã–±–µ—Ä–∏ —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏:
     [üö¥ –ö—É—Ä—å–µ—Ä]
     [üè¢ –§—Ä–∞–Ω—á–∞–π–∑–∏]
     [‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

### –®–∞–≥ 3: –í—ã–±–æ—Ä –æ—Ç–¥–µ–ª–∞
```
User: [–Ω–∞–∂–∏–º–∞–µ—Ç "üö¥ –ö—É—Ä—å–µ—Ä"]
Bot: ‚úÖ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –æ—Ç–¥–µ–ª: –ö—É—Ä—å–µ—Ä
     –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É UQsoft!
     [–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏]
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò–ó–û–õ–Ø–¶–ò–ò:

### –¢–µ—Å—Ç 1: –ö—É—Ä—å–µ—Ä –Ω–µ –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
```sql
-- 1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞
-- 2. –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫–æ–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏?"
-- 3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "–í –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
-- 4. ‚úÖ –ò–ó–û–õ–Ø–¶–ò–Ø –†–ê–ë–û–¢–ê–ï–¢!
```

### –¢–µ—Å—Ç 2: –°–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—å–µ—Ä–æ–≤
```sql
-- 1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫–∞  
-- 2. –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫–æ–π –∫–æ–¥ –æ—Ç —Å–∫–ª–∞–¥–∞?"
-- 3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "–í –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
-- 4. ‚úÖ –ò–ó–û–õ–Ø–¶–ò–Ø –†–ê–ë–û–¢–ê–ï–¢!
```

### –¢–µ—Å—Ç 3: –í—Å–µ –≤–∏–¥—è—Ç common —Ñ–∞–π–ª—ã
```sql
-- 1. –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∫—É—Ä—å–µ—Ä / —Å–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫)
-- 2. –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏?"
-- 3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "support@uqsoft.com, hr@uqsoft.com"
-- 4. ‚úÖ –û–ë–©–ò–ï –ó–ù–ê–ù–ò–Ø –î–û–°–¢–£–ü–ù–´ –í–°–ï–ú!
```

---

## üìÇ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í:

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
```
c:\projects\UQ-bot\
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py ‚úÖ (–¥–æ–±–∞–≤–ª–µ–Ω Department enum + –∫–æ–ª–æ–Ω–∫–∞ department)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration_add_department.py ‚úÖ (–º–∏–≥—Ä–∞—Ü–∏—è –ë–î)
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ start.py ‚úÖ (–≤—ã–±–æ—Ä –æ—Ç–¥–µ–ª–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ keyboards/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ department.py ‚úÖ (–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤—ã–±–æ—Ä–∞ –æ—Ç–¥–µ–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai_service.py ‚úÖ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã + –∏–∑–æ–ª—è—Ü–∏—è)
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ department.py ‚úÖ (—É—Ç–∏–ª–∏—Ç—ã —Ä–∞–±–æ—Ç—ã —Å –æ—Ç–¥–µ–ª–∞–º–∏)
‚îÇ       ‚îî‚îÄ‚îÄ states.py ‚úÖ (FSM –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ knowledge/
        ‚îú‚îÄ‚îÄ common/ ‚úÖ (25 —Ñ–∞–π–ª–æ–≤ - –≤–∏–¥—è—Ç –í–°–ï)
        ‚îú‚îÄ‚îÄ delivery/
        ‚îÇ   ‚îú‚îÄ‚îÄ courier/ ‚úÖ (courier_guide.txt - —Ç–æ–ª—å–∫–æ –∫—É—Ä—å–µ—Ä—ã)
        ‚îÇ   ‚îî‚îÄ‚îÄ franchise/ ‚úÖ (–ø—É—Å—Ç–æ - —Ç–æ–ª—å–∫–æ common)
        ‚îú‚îÄ‚îÄ sorting/ ‚úÖ (sorting_rules.txt - —Ç–æ–ª—å–∫–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞)
        ‚îî‚îÄ‚îÄ customer_service/ ‚úÖ (–ø—É—Å—Ç–æ - —Ç–æ–ª—å–∫–æ common)
```

---

## üîç –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –ü–û–ò–°–ö:

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤ `get_answer()`:
```python
1. –ü–æ–ª—É—á–∏—Ç—å department –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
   ‚Üì
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–∞ (RU/EN/ZH)
   ‚Üì
3. –ï—Å–ª–∏ –Ω–µ —Ä—É—Å—Å–∫–∏–π ‚Üí –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
   ‚Üì
4. –í—ã–±—Ä–∞—Ç—å –∏–Ω–¥–µ–∫—Å –æ—Ç–¥–µ–ª–∞: _vector_stores[department]
   ‚Üì
5. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞
   ‚Üì
6. –ò—Å–∫–∞—Ç—å –≤ –∏–Ω–¥–µ–∫—Å–µ –¢–û–õ–¨–ö–û —ç—Ç–æ–≥–æ –æ—Ç–¥–µ–ª–∞
   ‚Üì
7. –ù–∞–π—Ç–∏ top-3 —á–∞–Ω–∫–∞ –∏–∑ (common + department)
   ‚Üì
8. –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —è–∑—ã–∫–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```
[RAG] User 12345 (Dept: delivery/courier) searching for 3 most relevant chunks...
[RAG] Found 3 relevant chunks from 2 files: ['common/welcome.txt', 'delivery/courier/courier_guide.txt']
```

---

## üéØ NEXT STEPS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

### 1. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ—Ç–¥–µ–ª–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–Ω–∞–Ω–∏–π
- –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞/–≥–æ–ª–æ—Å–∞ ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –æ—Ç–¥–µ–ª–æ–≤
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–∞–ø–∫—É
- **–ü–æ–∫–∞ –∞–¥–º–∏–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –≤—Å–µ –≤ common/ - —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!**

### 2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –æ—Ç–¥–µ–ª–∞–º–∏
- –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

### 3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –æ—Ç–¥–µ–ª–∞–º
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –∫–∞–∂–¥–æ–º –æ—Ç–¥–µ–ª–µ

---

## üöÄ –°–¢–ê–¢–£–°: –ì–û–¢–û–í –ö PRODUCTION!

Multitenancy —Å–∏—Å—Ç–µ–º–∞ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∞—è** –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –∑–Ω–∞–Ω–∏–π –º–µ–∂–¥—É –æ—Ç–¥–µ–ª–∞–º–∏
- ‚úÖ –û–±—â–∏–µ –∑–Ω–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö (common/)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –æ—Ç–¥–µ–ª–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ FAISS –∏–Ω–¥–µ–∫—Å—ã (4 –æ—Ç–¥–µ–ª–∞)
- ‚úÖ –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å (RU/EN/ZH)
- ‚úÖ –ê–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- üîí –ö—É—Ä—å–µ—Ä –ù–ï –≤–∏–¥–∏—Ç —Å–µ–∫—Ä–µ—Ç—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- üîí –°–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫ –ù–ï –≤–∏–¥–∏—Ç —Å–µ–∫—Ä–µ—Ç—ã –∫—É—Ä—å–µ—Ä–æ–≤
- üîí –ö–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω
- üîí –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º
